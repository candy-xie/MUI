<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>购物车交互</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/iconfont/iconfont.css">
</head>
<body style="background: rgb(240, 242, 245);">
    <div class="bar bar-header">
        <h1 class="title">购物车</h1>
    </div>
    <div class="content scroll-content has-header has-footer">
        <div class="list list-customize-order">
            <div class="item item-checkbox item-icon-right store-link">
                <label class="checkbox checkPart">
                    <input type="checkbox">
                </label>
                易生活副食直营
                <i class="iconfont icon-jiantou2"></i>
            </div>
            <div class="swipeCon">
                <div class="item item-checkbox item-product">
                    <label class="checkbox">
                        <input type="checkbox">
                    </label>
                    <div class="product">
                        <div class="product-img">
                            <img src="../images/product-img.jpg">
                        </div>
                        <div class="product-info">
                            <h2>雀巢威化20g-巧克力味(支雀巢威化20g-巧克力雀巢威化20g-巧克力味(支雀巢威化20g-巧克力</h2>
                            <p>规格: 1.5L*6瓶*箱</p>
                            <div class="price">
                                ￥186.50
                                <div class="quantity">
                                    <a href="javascript:;"  class="disabled minus"  onclick="minus(this,'186.50','20');">
                                        <i class="iconfont icon-minus"></i>
                                    </a>
                                    <input value="1" type="number" onblur="amount_input(this,'186.50','20')">
                                    <a href="javascript:;" class="plus"  onclick="plus(this,'186.50','20');">
                                        <i class="iconfont icon-plus"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="product-delete">
                    <a href="javascript:void(0);">删除</a>
                </div>
            </div>

            <div class="swipeCon">
                <div class="item item-checkbox item-product">
                    <label class="checkbox">
                        <input type="checkbox">
                    </label>
                    <div class="product">
                        <div class="product-img">
                            <img src="../images/product-img.jpg">
                        </div>
                        <div class="product-info">
                            <h2>雀巢威化20g-巧克力味(支雀巢威化20g-巧克力雀巢威化20g-巧克力味(支雀巢威化20g-巧克力</h2>
                            <p>规格: 1.5L*6瓶*箱</p>
                            <div class="price">
                                ￥9.90
                                <div class="quantity">
                                    <a href="javascript:;" class="disabled minus" onclick="minus(this,'9.9','20');">
                                        <i class="iconfont icon-minus"></i>
                                    </a>
                                    <input type="number"  value="1" onblur="amount_input(this,'9.9','20')">
                                    <a href="javascript:;" class="plus" onclick="plus(this,'9.9','20');">
                                        <i class="iconfont icon-plus"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="product-delete">
                    <a href="javascript:void(0);">删除</a>
                </div>
            </div>
        </div>
        <div class="list list-customize-order">
            <div class="item item-checkbox item-icon-right store-link">
                <label class="checkbox checkPart">
                    <input type="checkbox">
                </label>
                易生活副食直营
                <i class="iconfont icon-jiantou2"></i>
            </div>
            <div class="swipeCon">
                <div class="item item-checkbox item-product">
                    <label class="checkbox">
                        <input type="checkbox">
                    </label>
                    <div class="product">
                        <div class="product-img">
                            <img src="../images/product-img.jpg">
                            <div class="out-of-stock">暂时缺货</div>
                        </div>
                        <div class="product-info">
                            <h2>雀巢威化20g-巧克力味(支雀巢威化20g-巧克力雀巢威化20g-巧克力味(支雀巢威化20g-巧克力</h2>
                            <p>规格: 1.5L*6瓶*箱</p>
                            <div class="price">
                                ￥86.50
                                <div class="quantity">
                                    <a href="javascript:;" class="disabled minus" onblur="minus(this,'86.50','10');">
                                        <i class="iconfont icon-minus"></i>
                                    </a>
                                    <input type="number" value="1" onclick="amount_input(this,'86.50','10')">
                                    <a href="javascript:;" class="plus"  onclick="plus(this,'86.50','10');">
                                        <i class="iconfont icon-plus"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="product-delete">
                    <a href="javascript:void(0);">删除</a>
                </div>
            </div>

        </div>

    </div>
    <div class="bar bar-footer footer-no-padding">
        <div class="row">
            <div class="col-66">
                <div class="item-checkbox">
                    <label class="checkbox checkAll">
                        <input type="checkbox">
                    </label>
                    全选
                </div>
                <p class="total-price">总计：￥<span class="num">9.00</span></p>
            </div>
            <div class="col-33">
                <button class="button button-positive button-full">
                    加入进货单(<span>1</span>)
                </button>
            </div>
        </div>
    </div>
    <script src="../js/classie.js"></script>
    <script src="../js/jquery.min.js"></script>


    <script>
        //侧滑显示删除按钮
        var expansion;
        var item = document.querySelectorAll('.swipeCon');
        for (var i=0;i<item.length;i++){
            var x,X,swipeX,productDelete;
            // 清空左滑
            function clearSwipe(event){
                x= event.changedTouches[0].pageX;
                swipeX = true;
                if(expansion) {
                    classie.remove( expansion, 'swipeleft' )
                }

            }
//            左右滑动
            function swipe(event) {
                X = event.changedTouches[0].pageX;
//                左右滑动
                if(swipeX && (X-x) > 0){   //右滑
                    event.preventDefault();
                    classie.remove( this, 'swipeleft' ); //右滑动收起
                }else if(swipeX && (X-x) < 0){   //左滑
                    event.preventDefault();
                    classie.add( this, 'swipeleft' );
                    expansion = this;
                }
            }
            item[i].addEventListener('touchstart',clearSwipe);
            item[i].addEventListener('touchmove',swipe);

//            删除事件
            productDelete = item[i].getElementsByClassName("product-delete")[0];
            productDelete.addEventListener('click',function (event) {
                var swipeCon = this.parentNode;
                swipeCon.removeEventListener('touchstart',clearSwipe);
                swipeCon.style.display = "none";
            });
        }

//        数量加
         function plus(tag,sellprice,stock) {
             var _this = $(tag);
             var input = _this.prev('input');
             var minus = _this.parent().children('.minus');
             if(_this.prev('input[disabled]').length > 0){
                 return;
             }
             var amount = parseInt(input.val());
             amount ++;
             minus.removeClass('disabled');
             if(amount > stock){
                 alert("购买数量不能超过最大库存");
                 console.log('fd')
             }else{
                 input.val(amount);
             }

         }

//        数量减
        function minus(tag,sellprice) {
            var _this = $(tag);
            var input = _this.next('input');
            if(_this.prev('input[disabled]').length > 0){
                return;
            }
            var amount = parseInt(input.val());
            amount --;
            if(amount <= 0){
                _this.addClass('disabled');
                alert('最少购买量为1');
//                return false;
            }else{
                input.val(amount)
            }
        }

//        单选
        $('.checkbox').click(function (event) {
            event.preventDefault();
            var input = $(this).find('input');
//            console.log(input);
            input.toggleClass('checked');

//          部分选择CheckBox 数量
            var checkLen = $(this).parents('.list-customize-order').children('.swipeCon').length;
            console.log(checkLen);
            var checkckLen = $(this).parents('.list-customize-order').find('.swipeCon .checkbox input').filter('.checked').length;
            console.log(checkckLen);
            var checkPart = $(this).parents('.list-customize-order').find('.checkPart input');
            if(checkLen == checkckLen){
                checkPart.addClass('checked');
            }else{
                checkPart.removeClass('checked');
            }

//            全选
            var checkAllLen = $('.checkbox').length-1;
            var checkAllCkLen = $('.checkbox').children('input').filter('.checked').length;
            if(checkAllLen == checkAllCkLen){
                $('.checkAll input').addClass('checked');
            }else{
                $('.checkAll input').removeClass('checked');
            }


        })

//        全选
        $('.checkAll').click(function () {
            var checkbox = $('.checkbox').find('input');
            $(this).toggleClass('checked');
            if($(this).hasClass('checked')){
                checkbox.addClass('checked');
            }else{
                checkbox.removeClass('checked');
            }
        })
//

//        部分全选
        $('.checkPart').click(function () {
            var checkbox = $(this).parent('.store-link').siblings('.swipeCon').find('.checkbox input');
//            console.log(checkbox.length);
            $(this).children('input').toggleClass('checked');
            if($(this).children('input').hasClass('checked')){
                checkbox.addClass('checked');
            }else{
                checkbox.removeClass('checked');
            }

            var checkPartLen = $('.checkPart').length;
            var checkPartCkLen = $('.checkPart').children('input').filter('.checked').length;
            if(checkPartCkLen == checkPartLen){
                $('.checkAll input').addClass('checked');
            }else{
                $('.checkAll input').removeClass('checked');
            }
        })

//        手动修改文本输入框
        function amount_input(tag,price,stock) {
            var amount = parseInt($(tag).val());
            if(amount < 1){
                alert('最少购买量为1');
                $(tag).val(1);
            }else if(amount >1 && amount <stock){
                $(tag).parent().children('.minus').removeClass('disabled');
            }else if(amount > stock){
                alert('超出最大购买量');
                $(tag).val(stock)
            }

            
        }


    </script>
</body>
</html>